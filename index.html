<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolê Certo | Eventos Sociais</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #f05537;
            --secondary: #39364f;
            --light: #f8f7fa;
            --dark: #1e0a3c;
            --gray: #6f7287;
            --verde: #4CAF50;
            --laranja: #FF9800;
            --roxo: #9C27B0;
            --cinza-claro: #f8f9fa;
            --cinza-escuro: #343a40;
            --branco: #ffffff;
            --sombra: 0 8px 24px rgba(0, 0, 0, 0.12);
            --sombra-card: 0 6px 16px rgba(0, 0, 0, 0.1);
            --borda: 1px solid rgba(0, 0, 0, 0.08);
            --transicao: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--light);
            color: var(--secondary);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        /* Header no estilo Eventbrite */
        header {
            background: linear-gradient(90deg, var(--dark) 0%, #4a154b 100%);
            color: var(--branco);
            padding: 15px 5%;
            border-radius: 16px;
            box-shadow: var(--sombra);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .logo-main {
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: var(--branco);
        }

        .logo-sub {
            font-size: 1rem;
            font-weight: 500;
            opacity: 0.9;
            color: var(--branco);
        }

        .nav-container {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transicao);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: var(--branco);
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        /* Estilo para o novo botão de login do Google */
        /* Removido o estilo específico para o login do Google para torná-lo mais discreto e profissional */
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            min-height: 70vh;
        }

        /* Hero Section no estilo Eventbrite */
        .hero {
            background: linear-gradient(rgba(30, 10, 60, 0.85), rgba(30, 10, 60, 0.85)), url('https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80') center/cover;
            color: white;
            padding: 80px 20px;
            text-align: center;
            border-radius: 16px;
            margin-bottom: 40px;
            box-shadow: var(--sombra);
        }

        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 40px;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 4px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: var(--transicao);
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .section {
            padding: 40px 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .section-header p {
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.1rem;
        }

        /* Grid de eventos no estilo Eventbrite */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Cards de eventos melhorados */
        .event-card {
            background: var(--branco);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--sombra-card);
            transition: var(--transicao);
            display: flex;
            flex-direction: column;
            height: 100%;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.1);
        }

        .card-header {
            padding: 12px 16px;
            position: relative;
            background: var(--light);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .event-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--secondary);
            line-height: 1.3;
        }

        .event-badge {
            background: rgba(0, 0, 0, 0.05);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
            color: var(--gray);
        }

        .card-content {
            padding: 16px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .date-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .date-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: var(--light);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .day {
            font-size: 1.2rem;
            font-weight: 700;
            line-height: 1;
            color: var(--primary);
        }

        .month {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: -2px;
            color: var(--gray);
        }

        .date-info {
            flex: 1;
        }

        .event-date {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--secondary);
            margin-bottom: 3px;
        }

        .event-time {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .event-info {
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 0.9rem;
        }

        .event-info i {
            min-width: 20px;
            color: var(--primary);
            font-size: 1rem;
            margin-top: 3px;
        }

        .event-detail {
            color: var(--gray);
            line-height: 1.4;
        }

        .card-footer {
            display: flex;
            padding: 0 16px 16px;
            gap: 10px;
        }

        .card-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: var(--light);
            color: var(--secondary);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transicao);
            font-size: 0.85rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-btn:hover {
            background: var(--primary);
            color: var(--branco);
            border-color: var(--primary);
        }

        /* Página de detalhes melhorada */
        .detalhes-container {
            background: var(--branco);
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .detalhes-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .detalhes-titulo {
            font-size: 2rem;
            color: var(--secondary);
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .detalhes-categoria {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .detalhes-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .info-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(240, 85, 55, 0.03);
            transition: var(--transicao);
        }

        .info-item:hover {
            background: rgba(240, 85, 55, 0.08);
        }

        .info-icon {
            color: var(--primary);
            font-size: 1.4rem;
            min-width: 40px;
            height: 40px;
            background: rgba(240, 85, 55, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-text h3 {
            margin-bottom: 8px;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1rem;
            letter-spacing: 0.5px;
        }

        .info-text p {
            color: var(--gray);
            font-weight: 500;
            font-size: 1.05rem;
            line-height: 1.5;
        }

        .detalhes-descricao {
            padding: 25px 0;
            margin-bottom: 30px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .detalhes-descricao h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detalhes-descricao h3 i {
            color: var(--primary);
        }

        .detalhes-descricao p {
            color: var(--gray);
            font-size: 1.1rem;
            line-height: 1.7;
        }
        
        /* Novo estilo para o mapa */
        #map-container {
            margin-top: 30px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding-top: 30px;
        }
        #map-container h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 12px;
            box-shadow: var(--sombra-card);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        .map-error {
            text-align: center;
            color: var(--gray);
            padding: 20px;
            border-radius: 8px;
            background: var(--light);
        }
        
        .presenca-section {
            margin: 35px 0;
            padding: 25px;
            background: var(--light);
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .presenca-title {
            margin-bottom: 20px;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .presenca-title i {
            color: var(--primary);
        }

        .input-nome {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: var(--transicao);
        }

        .input-nome:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(240, 85, 55, 0.2);
        }

        .opcoes-presenca {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-presenca {
            padding: 14px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transicao);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .btn-confirmar {
            background: var(--verde);
            color: var(--branco);
        }

        .btn-talvez {
            background: var(--laranja);
            color: var(--branco);
        }

        .btn-recusar {
            background: var(--roxo);
            color: var(--branco);
        }

        .btn-presenca:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .feedback {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            display: none;
            font-weight: 500;
            font-size: 1.05rem;
        }

        .feedback.ativo {
            display: block;
            animation: fadeIn 0.5s;
        }

        .feedback-confirmado {
            background: rgba(76, 175, 80, 0.1);
            color: var(--verde);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .feedback-talvez {
            background: rgba(255, 152, 0, 0.1);
            color: var(--laranja);
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .feedback-recusado {
            background: rgba(156, 39, 176, 0.1);
            color: var(--roxo);
            border: 1px solid rgba(156, 39, 176, 0.3);
        }
        
        .participantes-section {
            margin: 40px 0 30px;
        }
        .participantes-section h3 {
            margin-bottom: 20px;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .participantes-section h3 i {
            color: var(--primary);
        }
        .status-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }
        .status-box {
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        .status-box.confirmados {
            border-top: 4px solid var(--verde);
        }
        .status-box.pendentes {
            border-top: 4px solid var(--laranja);
        }
        .status-box.recusados {
            border-top: 4px solid var(--roxo);
        }
        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .status-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-count {
            font-weight: 700;
            font-size: 1.1rem;
        }
        .status-box.confirmados .status-title {
            color: var(--verde);
        }
        .status-box.pendentes .status-title {
            color: var(--laranja);
        }
        .status-box.recusados .status-title {
            color: var(--roxo);
        }
        .participantes-lista {
            list-style: none;
        }
        .participantes-lista li {
            padding: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        }
        .participantes-lista li:last-child {
            border-bottom: none;
        }
        .participantes-lista li i {
            color: var(--primary);
            font-size: 0.9rem;
        }
        .acoes-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .btn-acao {
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transicao);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .btn-voltar {
            background: var(--gray);
            color: var(--branco);
        }
        .btn-editar {
            background: var(--laranja);
            color: var(--branco);
        }
        .btn-excluir {
            background: #f44336;
            color: var(--branco);
        }
        .btn-acao:hover {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        /* Formulário no estilo Eventbrite */
        .form-container {
            background: var(--branco);
            border-radius: 16px;
            box-shadow: var(--sombra-card);
            padding: 30px;
            max-width: 600px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: var(--borda);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--light);
        }
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .btn-submit {
            background: var(--primary);
            color: var(--branco);
            border: none;
            padding: 14px 30px;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: block;
            margin: 30px auto 0;
            transition: var(--transicao);
        }
        .btn-submit:hover {
            background: #d04a30;
            transform: translateY(-3px);
        }
        /* Botão flutuante no estilo Eventbrite */
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--branco);
            border: none;
            box-shadow: 0 6px 20px rgba(240, 85, 55, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            z-index: 100;
            transition: var(--transicao);
        }
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(240, 85, 55, 0.6);
        }
        .loading {
            display: flex;
            justify-content: center;
            padding: 30px;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        /* NOVAS CORES PARA AS CATEGORIAS */
        .categoria-musica .event-badge { background: rgba(76, 175, 80, 0.1); color: #4CAF50; }
        .categoria-artes .event-badge { background: rgba(156, 39, 176, 0.1); color: #9C27B0; }
        .categoria-teatro .event-badge { background: rgba(255, 152, 0, 0.1); color: #FF9800; }
        .categoria-literatura .event-badge { background: rgba(33, 150, 243, 0.1); color: #2196F3; }
        .categoria-intervencoes .event-badge { background: rgba(244, 67, 54, 0.1); color: #f44336; }
        .categoria-cultura .event-badge { background: rgba(0, 150, 136, 0.1); color: #009688; }
        .categoria-natureza .event-badge { background: rgba(63, 81, 181, 0.1); color: #3f51b5; }
        .categoria-outro .event-badge { background: rgba(96, 125, 139, 0.1); color: #607d8b; }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <!-- Adiciona o script da API do Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/jwt-decode/build/jwt-decode.js"></script>

    <header>
        <div class="logo">
            <span class="logo-main">Rolê Certo</span>
            <span class="logo-sub">Eventos Sociais</span>
        </div>
        <div class="nav-container">
            <button id="nav-btn-home" class="nav-btn active"><i class="fas fa-home"></i> Início</button>
            <button id="nav-btn-adicionar" class="nav-btn"><i class="fas fa-plus"></i> Adicionar</button>
            
            <!-- Botão para login com o Google (agora mais discreto) -->
            <button id="google-login-btn" class="nav-btn" style="display: none;">
                <i class="fas fa-sign-in-alt"></i> Entrar
            </button>
            <!-- Div para exibir informações do usuário logado -->
            <div id="user-info-container" class="flex items-center gap-2" style="display: none;">
                <img id="user-profile-pic" class="w-8 h-8 rounded-full" alt="Foto de perfil">
                <span id="user-name" class="font-medium"></span>
                <button id="sign-out-btn" class="text-sm font-light text-white/70 hover:text-white transition-colors">
                    Sair
                </button>
            </div>
        </div>
    </header>

    <div class="container">

        <!-- Página de Início (Home) -->
        <div id="home" class="page active">
            <div class="hero">
                <h1>O que você vai fazer hoje?</h1>
                <p>Encontre eventos sociais na sua quebrada ou adicione o seu próprio rolê para a galera!</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" onclick="window.location.href='#eventos';">Encontre Eventos</button>
                    <button id="hero-btn-adicionar" class="btn btn-outline"><i class="fas fa-plus"></i> Adicione um Evento</button>
                </div>
            </div>

            <section id="eventos" class="section">
                <div class="section-header">
                    <h2>Próximos Rolês</h2>
                    <p>Fique por dentro de tudo que está rolando na sua região. Músicas, arte, teatro e muito mais!</p>
                </div>
                <div id="eventos-container" class="grid">
                    <!-- Cards de eventos serão inseridos aqui via JavaScript -->
                </div>
                <div id="no-events-message" class="text-center text-gray-500 mt-10" style="display: none;">
                    Nenhum evento encontrado. Que tal adicionar o primeiro?
                </div>
                <div id="loading-spinner" class="loading" style="display: none;">
                    <div class="loading-spinner"></div>
                </div>
            </section>
        </div>

        <!-- Página de Adicionar Evento -->
        <div id="adicionar" class="page">
            <div class="section-header">
                <h2>Adicionar Novo Rolê</h2>
                <p>Preencha os detalhes do seu evento para que outras pessoas possam encontrá-lo e participar.</p>
            </div>
            <div class="form-container">
                <form id="form-adicionar-evento">
                    <div class="form-group">
                        <label for="titulo" class="form-label">Título do Evento</label>
                        <input type="text" id="titulo" name="titulo" class="form-input" placeholder="Ex: Roda de Samba da Comunidade" required>
                    </div>
                    <div class="form-group">
                        <label for="tipo" class="form-label">Tipo de Evento</label>
                        <select id="tipo" name="tipo" class="form-select" required>
                            <option value="">Selecione um tipo...</option>
                            <option value="musica">Música ao Vivo</option>
                            <option value="artes">Artes Visuais</option>
                            <option value="teatro">Teatro & Dança</option>
                            <option value="literatura">Literatura & Conhecimento</option>
                            <option value="intervencoes">Intervenções Urbanas</option>
                            <option value="cultura">Cultura na Quebrada</option>
                            <option value="natureza">Natureza & Cultura</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="descricao" class="form-label">Descrição</label>
                        <textarea id="descricao" name="descricao" class="form-textarea" placeholder="Descreva seu evento com detalhes..." required></textarea>
                    </div>
                    <div class="form-group form-row">
                        <div>
                            <label for="data" class="form-label">Data</label>
                            <input type="date" id="data" name="data" class="form-input" required>
                        </div>
                        <div>
                            <label for="hora" class="form-label">Hora</label>
                            <input type="time" id="hora" name="hora" class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="local" class="form-label">Local</label>
                        <input type="text" id="local" name="local" class="form-input" placeholder="Ex: Praça do Campo Limpo, Rua X, 123" required>
                    </div>
                    <div class="form-group">
                        <label for="organizador" class="form-label">Organizador</label>
                        <input type="text" id="organizador" name="organizador" class="form-input" placeholder="Seu nome ou o nome da organização" required>
                    </div>
                    <div id="adicionar-evento-feedback" class="feedback"></div>
                    <button type="submit" class="btn-submit">Publicar Evento</button>
                </form>
            </div>
        </div>

        <!-- Página de Detalhes do Evento (dinâmica) -->
        <div id="detalhes" class="page">
            <div class="detalhes-container">
                <div class="detalhes-header">
                    <h1 id="detalhes-titulo" class="detalhes-titulo"></h1>
                    <span id="detalhes-categoria" class="detalhes-categoria"></span>
                </div>
                <div class="detalhes-info">
                    <div class="info-item">
                        <div class="info-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="info-text">
                            <h3>Data e Hora</h3>
                            <p id="detalhes-data"></p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <div class="info-text">
                            <h3>Local</h3>
                            <p id="detalhes-local"></p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-icon"><i class="fas fa-user-circle"></i></div>
                        <div class="info-text">
                            <h3>Organizador</h3>
                            <p id="detalhes-organizador"></p>
                        </div>
                    </div>
                </div>
                <div class="detalhes-descricao">
                    <h3><i class="fas fa-info-circle"></i> Sobre o evento</h3>
                    <p id="detalhes-descricao-texto"></p>
                </div>

                <div id="map-container">
                    <h3><i class="fas fa-map"></i> Localização no Mapa</h3>
                    <div id="map"></div>
                    <div id="map-error-message" class="map-error" style="display: none;">Não foi possível carregar o mapa.</div>
                </div>

                <div class="presenca-section">
                    <h3 class="presenca-title"><i class="fas fa-calendar-check"></i> Você vai?</h3>
                    <div class="opcoes-presenca">
                        <button class="btn-presenca btn-confirmar" data-status="confirmado"><i class="fas fa-check"></i> Sim, com certeza!</button>
                        <button class="btn-presenca btn-talvez" data-status="pendente"><i class="fas fa-question"></i> Talvez</button>
                        <button class="btn-presenca btn-recusar" data-status="recusado"><i class="fas fa-times"></i> Não poderei</button>
                    </div>
                    <div id="presenca-feedback" class="feedback"></div>
                </div>
                
                <div id="participantes-section" class="participantes-section" style="display: none;">
                    <h3><i class="fas fa-users"></i> Quem vai?</h3>
                    <div class="status-container">
                        <!-- Participantes serão injetados aqui -->
                    </div>
                </div>

                <div class="acoes-container">
                    <button class="btn-acao btn-voltar"><i class="fas fa-arrow-left"></i> Voltar para Início</button>
                    <button class="btn-acao btn-editar" id="btn-editar-evento" style="display:none;"><i class="fas fa-edit"></i> Editar Evento</button>
                    <button class="btn-acao btn-excluir" id="btn-excluir-evento" style="display:none;"><i class="fas fa-trash-alt"></i> Excluir Evento</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Script principal da aplicação -->
    <script type="module">
        // IMPORTAÇÕES DO FIREBASE (NÃO REMOVER!)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, onSnapshot, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // Configurações do Firebase (fornecidas pelo ambiente)
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let userId = '';

        // Variáveis globais
        let eventos = [];
        let eventoAtualId = null;

        // Elementos do DOM
        const pages = document.querySelectorAll('.page');
        const navBtns = document.querySelectorAll('.nav-btn');
        const heroBtnAdicionar = document.getElementById('hero-btn-adicionar');
        const eventosContainer = document.getElementById('eventos-container');
        const formAdicionarEvento = document.getElementById('form-adicionar-evento');
        const detalhesPage = document.getElementById('detalhes');
        const btnVoltarDetalhes = detalhesPage.querySelector('.btn-voltar');
        const btnEditarEvento = document.getElementById('btn-editar-evento');
        const btnExcluirEvento = document.getElementById('btn-excluir-evento');
        const noEventsMessage = document.getElementById('no-events-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const presencaButtons = document.querySelectorAll('.btn-presenca');
        
        // Elementos de login do Google
        const googleLoginBtn = document.getElementById('google-login-btn');
        const userInfoContainer = document.getElementById('user-info-container');
        const userProfilePic = document.getElementById('user-profile-pic');
        const userNameSpan = document.getElementById('user-name');
        const signOutBtn = document.getElementById('sign-out-btn');
        
        // Função de login com Google usando um popup
        googleLoginBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                console.log("Usuário logado com sucesso:", user);
                updateUserInfo(user);
            } catch (error) {
                console.error("Erro ao fazer login com o Google:", error);
                const errorCode = error.code;
                const errorMessage = error.message;
                const email = error.customData?.email;
                const credential = GoogleAuthProvider.credentialFromError(error);
            }
        });

        // Função para fazer logout
        signOutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                console.log("Usuário desconectado.");
                showLoginButton();
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
            }
        });

        // Funções para atualizar a interface do usuário
        function showLoginButton() {
            googleLoginBtn.style.display = 'flex';
            userInfoContainer.style.display = 'none';
        }

        function updateUserInfo(user) {
            googleLoginBtn.style.display = 'none';
            userInfoContainer.style.display = 'flex';
            userNameSpan.textContent = user.displayName || user.email;
            if (user.photoURL) {
                userProfilePic.src = user.photoURL;
            } else {
                // Fallback para uma imagem de perfil padrão
                userProfilePic.src = 'https://placehold.co/150x150/f05537/fff?text=User';
            }
        }
        
        // Listener para o estado de autenticação do Firebase
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                console.log('Usuário autenticado:', userId);
                updateUserInfo(user);
                loadEvents();
            } else {
                userId = '';
                console.log('Usuário deslogado ou anônimo.');
                showLoginButton();
            }
        });

        // Adiciona um listener para o botão de 'Adicionar Evento' na página inicial
        heroBtnAdicionar.addEventListener('click', () => {
            switchPage('adicionar');
        });
        
        // Listener para navegação entre páginas
        navBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.id.replace('nav-btn-', '');
                switchPage(targetId);
            });
        });
        
        // Função para alternar entre as páginas
        function switchPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            navBtns.forEach(btn => btn.classList.remove('active'));
            const activeNavBtn = document.getElementById(`nav-btn-${pageId}`);
            if (activeNavBtn) {
                activeNavBtn.classList.add('active');
            }
        }

        // Função para carregar e exibir os eventos do Firestore
        async function loadEvents() {
            console.log('Carregando eventos...');
            loadingSpinner.style.display = 'flex';
            eventosContainer.innerHTML = '';
            noEventsMessage.style.display = 'none';

            try {
                // Adiciona um listener em tempo real para a coleção 'eventos'
                const q = collection(db, `artifacts/${appId}/public/data/eventos`);
                onSnapshot(q, (querySnapshot) => {
                    eventos = [];
                    querySnapshot.forEach((doc) => {
                        const evento = { id: doc.id, ...doc.data() };
                        eventos.push(evento);
                    });

                    eventos.sort((a, b) => new Date(a.data) - new Date(b.data));

                    renderEvents(eventos);
                    loadingSpinner.style.display = 'none';
                });
            } catch (error) {
                console.error("Erro ao carregar eventos:", error);
                loadingSpinner.style.display = 'none';
                noEventsMessage.textContent = 'Erro ao carregar os eventos. Tente novamente mais tarde.';
                noEventsMessage.style.display = 'block';
            }
        }
        
        // Função para renderizar os cards de eventos
        function renderEvents(eventosData) {
            eventosContainer.innerHTML = '';
            if (eventosData.length === 0) {
                noEventsMessage.style.display = 'block';
            } else {
                noEventsMessage.style.display = 'none';
                eventosData.forEach(evento => {
                    const eventCard = document.createElement('div');
                    eventCard.className = `event-card categoria-${evento.tipo}`;
                    eventCard.innerHTML = `
                        <div class="card-header">
                            <span class="event-badge">${formatarTipo(evento.tipo)}</span>
                        </div>
                        <div class="card-content">
                            <h3 class="event-title">${evento.titulo}</h3>
                            <div class="date-container">
                                <div class="date-circle">
                                    <span class="day">${new Date(evento.data).getDate()}</span>
                                    <span class="month">${new Date(evento.data).toLocaleString('pt-BR', { month: 'short' })}</span>
                                </div>
                                <div class="date-info">
                                    <p class="event-date">Data: ${formatarDataCompleta(evento.data)}</p>
                                    <p class="event-time">Horário: ${evento.hora ? evento.hora : 'Não informado'}</p>
                                </div>
                            </div>
                            <div class="event-info">
                                <i class="fas fa-map-marker-alt"></i>
                                <p class="event-detail">${evento.local}</p>
                            </div>
                        </div>
                    `;
                    eventCard.addEventListener('click', () => {
                        showEventDetails(evento.id);
                    });
                    eventosContainer.appendChild(eventCard);
                });
            }
        }
        
        // Função para exibir os detalhes de um evento específico
        async function showEventDetails(id) {
            eventoAtualId = id;
            switchPage('detalhes');
            loadingSpinner.style.display = 'flex';
            detalhesPage.style.display = 'none';

            try {
                const docRef = doc(db, `artifacts/${appId}/public/data/eventos`, id);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const evento = docSnap.data();
                    document.getElementById('detalhes-titulo').textContent = evento.titulo;
                    document.getElementById('detalhes-categoria').textContent = formatarTipo(evento.tipo);
                    document.getElementById('detalhes-data').textContent = `Dia ${formatarDataCompleta(evento.data)} às ${evento.hora ? evento.hora : 'Não informado'}`;
                    document.getElementById('detalhes-local').textContent = evento.local;
                    document.getElementById('detalhes-organizador').textContent = evento.organizador;
                    document.getElementById('detalhes-descricao-texto').textContent = evento.descricao;
                    
                    // Exibe ou esconde os botões de editar e excluir
                    if (evento.organizadorId === userId) {
                        btnEditarEvento.style.display = 'inline-flex';
                        btnExcluirEvento.style.display = 'inline-flex';
                    } else {
                        btnEditarEvento.style.display = 'none';
                        btnExcluirEvento.style.display = 'none';
                    }
                    
                    // Carrega o mapa
                    initMap(evento.local);
                    
                    // Carrega os participantes
                    loadParticipants(id);
                    
                    detalhesPage.style.display = 'block';
                    loadingSpinner.style.display = 'none';
                } else {
                    console.error("Nenhum evento encontrado!");
                    loadingSpinner.style.display = 'none';
                }
            } catch (error) {
                console.error("Erro ao buscar detalhes do evento:", error);
                loadingSpinner.style.display = 'none';
            }
        }
        
        // Função para carregar os participantes em tempo real
        function loadParticipants(eventoId) {
            const participantesSection = document.getElementById('participantes-section');
            if (userId) { // Apenas carrega se o usuário estiver logado
                participantesSection.style.display = 'block';
                
                const q = collection(db, `artifacts/${appId}/public/data/eventos/${eventoId}/participantes`);
                onSnapshot(q, (querySnapshot) => {
                    const participantes = [];
                    querySnapshot.forEach((doc) => {
                        participantes.push({ id: doc.id, ...doc.data() });
                    });
                    
                    renderParticipants(participantes);
                });
            } else {
                participantesSection.style.display = 'none';
            }
        }
        
        // Função para renderizar a lista de participantes
        function renderParticipants(participantes) {
            const statusContainer = document.querySelector('.status-container');
            statusContainer.innerHTML = '';
            
            const confirmados = participantes.filter(p => p.status === 'confirmado');
            const pendentes = participantes.filter(p => p.status === 'pendente');
            const recusados = participantes.filter(p => p.status === 'recusado');
            
            // Renderiza os confirmados
            statusContainer.appendChild(createStatusBox('Confirmados', confirmados, 'confirmados'));
            // Renderiza os pendentes
            statusContainer.appendChild(createStatusBox('Talvez', pendentes, 'pendentes'));
            // Renderiza os recusados
            statusContainer.appendChild(createStatusBox('Não podem ir', recusados, 'recusados'));
        }
        
        // Função auxiliar para criar as caixas de status dos participantes
        function createStatusBox(title, list, statusClass) {
            const box = document.createElement('div');
            box.className = `status-box ${statusClass}`;
            
            const listHtml = list.map(p => `<li><i class="fas fa-user-circle"></i>${p.nome}</li>`).join('');
            
            box.innerHTML = `
                <div class="status-header">
                    <div class="status-title">${title}</div>
                    <span class="status-count">${list.length}</span>
                </div>
                <ul class="participantes-lista">
                    ${listHtml}
                </ul>
            `;
            return box;
        }
        
        // Adiciona um listener para o formulário de adicionar evento
        formAdicionarEvento.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!userId) {
                showFeedback('adicionar-evento-feedback', 'Por favor, faça login para adicionar um evento.', 'erro');
                return;
            }

            const feedback = document.getElementById('adicionar-evento-feedback');
            const formData = new FormData(formAdicionarEvento);
            const data = Object.fromEntries(formData.entries());
            data.organizadorId = userId; // Adiciona o ID do usuário autenticado

            try {
                // Salva o novo evento na subcoleção pública
                const eventosCollectionRef = collection(db, `artifacts/${appId}/public/data/eventos`);
                await addDoc(eventosCollectionRef, data);

                showFeedback('adicionar-evento-feedback', 'Evento adicionado com sucesso!', 'sucesso');
                formAdicionarEvento.reset();
            } catch (e) {
                console.error("Erro ao adicionar documento: ", e);
                showFeedback('adicionar-evento-feedback', 'Erro ao adicionar o evento.', 'erro');
            }
        });
        
        // Adiciona listeners para os botões de presença
        presencaButtons.forEach(btn => {
            btn.addEventListener('click', async () => {
                const status = btn.dataset.status;
                const feedback = document.getElementById('presenca-feedback');

                if (!userId) {
                    showFeedback('presenca-feedback', 'Por favor, faça login para confirmar sua presença.', 'erro');
                    return;
                }
                
                if (eventoAtualId) {
                    try {
                        const participanteDocRef = doc(db, `artifacts/${appId}/public/data/eventos/${eventoAtualId}/participantes`, userId);
                        await setDoc(participanteDocRef, {
                            nome: auth.currentUser.displayName || auth.currentUser.email,
                            status: status
                        });
                        
                        showFeedback('presenca-feedback', `Sua presença foi marcada como '${formatarStatus(status)}'.`, 'sucesso');
                    } catch (e) {
                        console.error("Erro ao atualizar presença: ", e);
                        showFeedback('presenca-feedback', 'Erro ao atualizar sua presença. Tente novamente.', 'erro');
                    }
                }
            });
        });

        // Listener para o botão de voltar na página de detalhes
        btnVoltarDetalhes.addEventListener('click', () => {
            switchPage('home');
        });
        
        // Listener para o botão de editar evento (ainda a ser implementado)
        btnEditarEvento.addEventListener('click', () => {
            console.log('Botão de editar clicado');
            // TODO: Implementar a lógica de edição do evento
        });
        
        // Listener para o botão de excluir evento
        btnExcluirEvento.addEventListener('click', async () => {
            if (eventoAtualId && confirm('Tem certeza que deseja excluir este evento?')) {
                try {
                    const docRef = doc(db, `artifacts/${appId}/public/data/eventos`, eventoAtualId);
                    await deleteDoc(docRef);
                    console.log("Evento excluído com sucesso!");
                    switchPage('home');
                } catch (e) {
                    console.error("Erro ao excluir o evento: ", e);
                    // Exibe uma mensagem de erro na página de detalhes
                }
            }
        });
        
        // Funções auxiliares para formatação de dados
        function formatarTipo(tipo) {
            const tipos = {
                musica: 'Música ao Vivo',
                artes: 'Artes Visuais',
                teatro: 'Teatro & Dança',
                literatura: 'Literatura & Conhecimento',
                intervencoes: 'Intervenções Urbanas',
                cultura: 'Cultura na Quebrada',
                natureza: 'Natureza & Cultura',
                outro: 'Outro'
            };
            return tipos[tipo] || tipo;
        }

        function formatarStatus(status) {
            const statusMap = {
                confirmado: 'Confirmado',
                pendente: 'Talvez',
                recusado: 'Não poderei'
            };
            return statusMap[status] || status;
        }

        function formatarDataCompleta(dataString) {
            const [ano, mes, dia] = dataString.split('-');
            const data = new Date(Number(ano), Number(mes) - 1, Number(dia));
            const diaSemana = data.toLocaleDateString('pt-BR', { weekday: 'long' });
            return `${dia}/${mes}/${ano} (${diaSemana})`;
        }
        
        // Função para mostrar feedback na tela
        function showFeedback(elementId, message, type) {
            const feedbackElement = document.getElementById(elementId);
            feedbackElement.textContent = message;
            feedbackElement.className = `feedback ativo ${type === 'sucesso' ? 'feedback-confirmado' : 'feedback-recusado'}`;
            setTimeout(() => {
                feedbackElement.classList.remove('ativo');
            }, 5000);
        }

        // Funções do Mapa
        let map;
        async function initMap(address) {
            const geocodeUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=json`;
            try {
                const response = await fetch(geocodeUrl);
                const data = await response.json();
                
                if (data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lon = parseFloat(data[0].lon);
                    
                    if (!map) {
                        map = L.map('map').setView([lat, lon], 13);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                        }).addTo(map);
                    } else {
                        map.setView([lat, lon], 13);
                    }
                    L.marker([lat, lon]).addTo(map)
                        .bindPopup(address)
                        .openPopup();
                    
                    document.getElementById('map-container').style.display = 'block';
                    document.getElementById('map-error-message').style.display = 'none';

                } else {
                    document.getElementById('map-container').style.display = 'block';
                    document.getElementById('map-error-message').style.display = 'block';
                    document.getElementById('map').innerHTML = ''; // Limpa o mapa se não houver resultado
                }
            } catch (error) {
                console.error('Erro ao geocodificar o endereço:', error);
                document.getElementById('map-container').style.display = 'block';
                document.getElementById('map-error-message').style.display = 'block';
                document.getElementById('map').innerHTML = '';
            }
        }

        // Para evitar erros de referência se o mapa não existir
        if (typeof L !== 'undefined') {
            // A API Leaflet será carregada dinamicamente no `initMap`
        } else {
            console.warn("A API Leaflet não foi carregada. O mapa não funcionará.");
        }
        
    </script>
</body>
</html>
