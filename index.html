<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rol√™ Certo | Eventos com amigos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [TODO: Todo o CSS anterior permanece aqui] */
    </style>
</head>
<body>
    <!-- [TODO: Todo o HTML anterior permanece aqui] -->

    <script>
        // 1. Fun√ß√£o para decodificar par√¢metros da URL
        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            const regex = /([^&=]+)=?([^&]*)/g;
            
            let match;
            while (match = regex.exec(queryString)) {
                params[decodeURIComponent(match[1])] = decodeURIComponent(match[2]);
            }
            
            return params;
        }

        // 2. Fun√ß√£o para importar evento da URL
        function importEventFromUrl() {
            const params = getUrlParams();
            const eventData = params.eventData;
            
            if (eventData) {
                try {
                    // Decodificar dados do evento (Base64 ‚Üí JSON)
                    const decodedData = atob(eventData);
                    const event = JSON.parse(decodedData);
                    const events = getEvents();
                    
                    // Verificar se evento j√° existe
                    const exists = events.some(e => e.id === event.id);
                    
                    if (!exists) {
                        events.push(event);
                        saveEvents(events);
                        showToast('Evento importado!', 'success');
                    }
                    
                    // Redirecionar para visualiza√ß√£o do evento
                    window.location.href = `#event-${event.id}`;
                    
                } catch (e) {
                    console.error('Erro ao importar evento:', e);
                    showToast('Link inv√°lido!', 'error');
                }
            }
        }

        // 3. Fun√ß√£o de compartilhamento atualizada
        function shareEvent(eventId) {
            const events = getEvents();
            const event = events.find(e => e.id === eventId);
            
            if (!event) return;
            
            const eventDate = new Date(event.date);
            const formattedDate = eventDate.toLocaleDateString('pt-BR', { 
                day: 'numeric', 
                month: 'long',
                year: 'numeric'
            });
            
            // Codificar evento em Base64
            const jsonString = JSON.stringify(event);
            const base64Data = btoa(jsonString);
            
            // Criar link compat√≠vel com GitHub Pages
            const eventLink = `${window.location.origin}${window.location.pathname}?eventData=${base64Data}`;
            
            const message = encodeURIComponent(
                `üéâ Voc√™ est√° convidado para: *${event.name}*\n\n` +
                `üìÖ Data: ${formattedDate}\n` +
                `‚è∞ Hor√°rio: ${event.time}\n` +
                `üìç Local: ${event.location}\n\n` +
                `üîó Confirmar presen√ßa: ${eventLink}`
            );
            
            window.open(`https://wa.me/?text=${message}`, '_blank');
        }

        // 4. Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Etapa 1: Processar par√¢metros de importa√ß√£o
            if (window.location.search.includes('eventData')) {
                importEventFromUrl();
            }
            // Etapa 2: Processar visualiza√ß√£o de evento
            else if (window.location.hash.startsWith('#event-')) {
                const eventId = window.location.hash.split('-')[1];
                showEventDetail(eventId);
            }
            // Etapa 3: Carregar p√°gina inicial
            else {
                loadActiveEvents();
            }
            
            // [TODO: Restante do c√≥digo de inicializa√ß√£o]
        });
    </script>
</body>
</html>
