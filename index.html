<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolê Certo | Eventos Sociais</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Adicionando os arquivos CSS e JS do Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIINf9aJ53POiNDXCKtH7vL+zS95z8Yyq5o="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20n69z7Kz1y+X9dK95yP5Xz+nB4bLzW8a1r6n8+0QzY="
        crossorigin=""></script>
    
    <!-- Configurações do Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            signInWithCustomToken,
            signInAnonymously,
            onAuthStateChanged,
            // Importações para Google Sign-In
            GoogleAuthProvider,
            signInWithPopup,
            signOut,
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            doc,
            getDoc,
            setDoc,
            collection,
            query,
            onSnapshot,
            updateDoc,
            deleteDoc,
            addDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCQP5r1XeE03WWW-CPbHfqwYb50DN9Tk-V0",
            authDomain: "rolecertoeventos.firebaseapp.com",
            databaseURL: "https://rolecertoeventos-default-rtdb.firebaseio.com",
            projectId: "rolecertoeventos",
            storageBucket: "rolecertoeventos.firebasestorage.app",
            messagingSenderId: "758496389166",
            appId: "1:758496389166:web:be8f89aa0cb3c8b72457bf"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Define as variáveis globais para o Firestore
        window.db = db;
        window.auth = auth;
        window.onSnapshot = onSnapshot;
        window.collection = collection;
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.addDoc = addDoc;
        window.query = query;

        // Variável global para o userId
        window.userId = null;
        window.userName = null;
        window.userPhoto = null;

        // Observa o estado de autenticação para definir o userId e atualizar a UI
        onAuthStateChanged(auth, (user) => {
            const userAuthBtn = document.getElementById('user-auth-btn');
            const userNameDisplay = document.getElementById('user-name-display');

            if (user) {
                window.userId = user.uid;
                window.userName = user.displayName;
                window.userPhoto = user.photoURL;
                console.log("Usuário autenticado:", window.userId);

                // Atualiza a UI para o estado logado
                if (user.isAnonymous) {
                    userAuthBtn.innerHTML = `<i class="fas fa-sign-in-alt"></i> Entrar`;
                    userAuthBtn.onclick = showLoginModal;
                    userNameDisplay.style.display = 'none';
                    userAuthBtn.classList.remove('logged-in');
                } else {
                    userAuthBtn.innerHTML = `<i class="fas fa-sign-out-alt"></i> Sair`;
                    userAuthBtn.onclick = window.handleSignOut;
                    userAuthBtn.classList.add('logged-in');

                    userNameDisplay.innerHTML = `
                        <img src="${user.photoURL || 'https://placehold.co/32x32'}" alt="Foto de Perfil" class="w-8 h-8 rounded-full mr-2">
                        <span>${user.displayName || 'Usuário'}</span>
                    `;
                    userNameDisplay.style.display = 'flex';
                }
            } else {
                window.userId = null;
                window.userName = null;
                window.userPhoto = null;
                console.log("Usuário deslogado.");
                
                // Atualiza a UI para o estado deslogado
                userAuthBtn.innerHTML = `<i class="fas fa-sign-in-alt"></i> Entrar`;
                userAuthBtn.onclick = showLoginModal;
                userNameDisplay.style.display = 'none';
                userAuthBtn.classList.remove('logged-in');
                
                // Autenticação anônima se nenhum usuário estiver logado
                signInAnonymously(auth).catch((error) => {
                    console.error("Erro na autenticação anônima:", error);
                });
            }
        });

        // Função para lidar com o login do Google
        window.handleGoogleSignIn = async function() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                console.log("Login com Google bem-sucedido.");
                closeLoginModal(); // Fecha o modal após o login
            } catch (error) {
                console.error("Erro no login com Google:", error);
            }
        };

        // Função para lidar com o logout
        window.handleSignOut = async function() {
            try {
                await signOut(auth);
                console.log("Logout bem-sucedido.");
                showPage('home'); // Redireciona para a página inicial após o logout
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
            }
        };

    </script>
    <style>
        :root {
            --primary: #f05537;
            --secondary: #39364f;
            --light: #f8f7fa;
            --dark: #1e0a3c;
            --gray: #6f7287;
            --verde: #4CAF50;
            --laranja: #FF9800;
            --roxo: #9C27B0;
            --cinza-claro: #f8f9fa;
            --cinza-escuro: #343a40;
            --branco: #ffffff;
            --sombra: 0 8px 24px rgba(0, 0, 0, 0.12);
            --sombra-card: 0 6px 16px rgba(0, 0, 0, 0.1);
            --borda: 1px solid rgba(0, 0, 0, 0.08);
            --transicao: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--light);
            color: var(--secondary);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(90deg, var(--dark) 0%, #4a154b 100%);
            color: var(--branco);
            padding: 15px 5%;
            border-radius: 16px;
            box-shadow: var(--sombra);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .logo-main {
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: var(--branco);
        }

        .logo-sub {
            font-size: 1rem;
            font-weight: 500;
            opacity: 0.9;
            color: var(--branco);
        }

        .nav-container {
            display: flex;
            gap: 15px;
            align-items: center; /* Alinha os itens verticalmente */
        }

        .nav-btn {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transicao);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: var(--branco);
        }
        
        .nav-btn.logged-in {
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        #user-name-display {
            display: none;
            align-items: center;
            color: white;
            font-weight: 600;
            padding: 0 10px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.1);
            transition: var(--transicao);
            height: 42px;
        }
        
        #user-name-display img {
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            min-height: 70vh;
        }

        .hero {
            background: linear-gradient(rgba(30, 10, 60, 0.85), rgba(30, 10, 60, 0.85)), url('https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80') center/cover;
            color: white;
            padding: 80px 20px;
            text-align: center;
            border-radius: 16px;
            margin-bottom: 40px;
            box-shadow: var(--sombra);
        }

        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 40px;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 4px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: var(--transicao);
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .section {
            padding: 40px 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .section-header p {
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .event-card {
            background: var(--branco);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--sombra-card);
            transition: var(--transicao);
            display: flex;
            flex-direction: column;
            height: 100%;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.1);
        }

        .card-header {
            padding: 12px 16px;
            position: relative;
            background: var(--light);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .event-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--secondary);
            line-height: 1.3;
        }

        .event-badge {
            background: rgba(0, 0, 0, 0.05);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
            color: var(--gray);
        }

        .card-content {
            padding: 16px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .date-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .date-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: var(--light);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .day {
            font-size: 1.2rem;
            font-weight: 700;
            line-height: 1;
            color: var(--primary);
        }

        .month {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: -2px;
            color: var(--gray);
        }

        .date-info {
            flex: 1;
        }

        .event-date {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--secondary);
            margin-bottom: 3px;
        }

        .event-time {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .event-info {
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 0.9rem;
        }

        .event-info i {
            min-width: 20px;
            color: var(--primary);
            font-size: 1rem;
            margin-top: 3px;
        }

        .event-detail {
            color: var(--gray);
            line-height: 1.4;
        }

        .card-footer {
            display: flex;
            padding: 0 16px 16px;
            gap: 10px;
        }

        .card-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: var(--light);
            color: var(--secondary);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transicao);
            font-size: 0.85rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-btn:hover {
            background: var(--primary);
            color: var(--branco);
            border-color: var(--primary);
        }

        .detalhes-container {
            background: var(--branco);
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .detalhes-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .detalhes-titulo {
            font-size: 2rem;
            color: var(--secondary);
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .detalhes-categoria {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .detalhes-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .info-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(240, 85, 55, 0.03);
            transition: var(--transicao);
        }

        .info-item:hover {
            background: rgba(240, 85, 55, 0.08);
        }

        .info-icon {
            color: var(--primary);
            font-size: 1.4rem;
            min-width: 40px;
            height: 40px;
            background: rgba(240, 85, 55, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .info-text h3 {
            margin-bottom: 8px;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1rem;
            letter-spacing: 0.5px;
        }

        .info-text p {
            color: var(--gray);
            font-weight: 500;
            font-size: 1.05rem;
            line-height: 1.5;
        }

        .detalhes-descricao {
            padding: 25px 0;
            margin-bottom: 30px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .detalhes-descricao h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detalhes-descricao h3 i {
            color: var(--primary);
        }

        .detalhes-descricao p {
            color: var(--gray);
            font-size: 1.1rem;
            line-height: 1.7;
        }

        #map-container {
            margin-top: 30px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding-top: 30px;
            display: none;
        }

        #map-container h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #map {
            height: 400px;
            width: 100%;
            border-radius: 12px;
            box-shadow: var(--sombra-card);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .map-error {
            text-align: center;
            color: var(--gray);
            padding: 20px;
            border-radius: 8px;
            background: var(--light);
            display: none;
        }

        .presenca-section {
            margin: 35px 0;
            padding: 25px;
            background: var(--light);
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .presenca-title {
            margin-bottom: 20px;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .presenca-title i {
            color: var(--primary);
        }

        .input-nome {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: var(--transicao);
        }

        .input-nome:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(240, 85, 55, 0.2);
        }

        .opcoes-presenca {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-presenca {
            padding: 14px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transicao);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .btn-confirmar {
            background: var(--verde);
            color: var(--branco);
        }

        .btn-talvez {
            background: var(--laranja);
            color: var(--branco);
        }

        .btn-recusar {
            background: var(--roxo);
            color: var(--branco);
        }

        .btn-presenca:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .feedback {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            display: none;
            font-weight: 500;
            font-size: 1.05rem;
        }

        .feedback.ativo {
            display: block;
            animation: fadeIn 0.5s;
        }

        .feedback-confirmado {
            background: rgba(76, 175, 80, 0.1);
            color: var(--verde);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .feedback-talvez {
            background: rgba(255, 152, 0, 0.1);
            color: var(--laranja);
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .feedback-recusado {
            background: rgba(156, 39, 176, 0.1);
            color: var(--roxo);
            border: 1px solid rgba(156, 39, 176, 0.3);
        }

        .participantes-section {
            margin: 40px 0 30px;
        }

        .participantes-section h3 {
            margin-bottom: 20px;
            color: var(--secondary);
            font-weight: 600;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .participantes-section h3 i {
            color: var(--primary);
        }

        .status-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .status-box {
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .status-box.confirmados {
            border-top: 4px solid var(--verde);
        }

        .status-box.pendentes {
            border-top: 4px solid var(--laranja);
        }

        .status-box.recusados {
            border-top: 4px solid var(--roxo);
        }

        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .status-header h4 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .status-header span {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .status-header i {
            font-size: 1.2rem;
            margin-right: 8px;
        }

        .status-box.confirmados h4, .status-box.confirmados span, .status-box.confirmados i {
            color: var(--verde);
        }
        .status-box.pendentes h4, .status-box.pendentes span, .status-box.pendentes i {
            color: var(--laranja);
        }
        .status-box.recusados h4, .status-box.recusados span, .status-box.recusados i {
            color: var(--roxo);
        }

        .participantes-lista {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .participantes-lista li {
            font-size: 0.95rem;
            color: var(--secondary);
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .participantes-lista li:last-child {
            border-bottom: none;
        }

        /* Modal para formulário de criação de evento */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--branco);
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.4s ease-out;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: var(--gray);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transicao);
        }

        .modal-close:hover {
            color: var(--secondary);
            transform: scale(1.1);
        }

        .modal-content h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--dark);
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transicao);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(240, 85, 55, 0.2);
        }

        .form-group textarea {
            min-height: 100px;
        }

        .btn-form {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: var(--branco);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transicao);
            box-shadow: 0 4px 12px rgba(240, 85, 55, 0.25);
        }

        .btn-form:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(240, 85, 55, 0.35);
        }
        
        #create-event-message {
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
            color: var(--verde);
        }

        /* Modal para Login */
        #login-modal .modal-content {
            max-width: 400px;
        }
        
        #google-sign-in-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            transition: var(--transicao);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        #google-sign-in-btn:hover {
            background-color: #29263a;
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
        }
        
        /* Animações */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .footer {
            margin-top: 50px;
            padding: 30px 20px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <span class="logo-main">Rolê Certo</span>
            <span class="logo-sub">Eventos Sociais</span>
        </div>
        <div class="nav-container">
            <button class="nav-btn active" onclick="showPage('home')">
                <i class="fas fa-home"></i>
                Início
            </button>
            <button class="nav-btn" onclick="showCreateEventModal()">
                <i class="fas fa-plus-circle"></i>
                Criar Evento
            </button>
            
            <!-- Elementos para autenticação -->
            <div id="user-name-display" class="flex items-center"></div>
            <button id="user-auth-btn" class="nav-btn" onclick="showLoginModal()">
                <i class="fas fa-sign-in-alt"></i>
                Entrar
            </button>
        </div>
    </header>

    <div class="container">
        <!-- Página Inicial -->
        <div id="home" class="page active">
            <section class="hero">
                <h1>Descubra os Melhores Rolês da Cidade</h1>
                <p>Encontre eventos sociais que combinam com seu estilo, crie seus próprios e convide seus amigos.</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" onclick="showCreateEventModal()">Criar Evento</button>
                    <a href="#eventos-destaque" class="btn btn-outline">Explorar Eventos</a>
                </div>
            </section>
            
            <section id="eventos-destaque" class="section">
                <div class="section-header">
                    <h2>Eventos em Destaque</h2>
                    <p>Veja os eventos mais recentes e populares criados pela nossa comunidade.</p>
                </div>
                <div id="eventos-container" class="grid">
                    <!-- Os cards de eventos serão injetados aqui via JavaScript -->
                </div>
            </section>
        </div>

        <!-- Página de Detalhes do Evento -->
        <div id="detalhes-evento" class="page">
            <div class="detalhes-container">
                <div class="detalhes-header">
                    <h1 id="detalhes-titulo" class="detalhes-titulo"></h1>
                    <span id="detalhes-categoria" class="detalhes-categoria"></span>
                </div>
                
                <div class="detalhes-info" id="detalhes-info">
                    <!-- Detalhes do evento injetados aqui -->
                </div>

                <div class="detalhes-descricao">
                    <h3><i class="fas fa-info-circle"></i> Sobre o Evento</h3>
                    <p id="detalhes-descricao"></p>
                </div>
                
                <div id="map-container">
                    <h3><i class="fas fa-map-marker-alt"></i> Local do Evento</h3>
                    <div id="map"></div>
                    <div id="map-error-message" class="map-error">Não foi possível carregar o mapa para este endereço.</div>
                </div>

                <section class="presenca-section">
                    <h4 class="presenca-title"><i class="fas fa-calendar-check"></i> Confirme sua presença</h4>
                    <input type="text" id="nome-participante" class="input-nome" placeholder="Seu nome completo">
                    <div class="opcoes-presenca">
                        <button class="btn-presenca btn-confirmar" onclick="salvarPresenca('Confirmado')">
                            <i class="fas fa-check"></i> Confirmar
                        </button>
                        <button class="btn-presenca btn-talvez" onclick="salvarPresenca('Talvez')">
                            <i class="fas fa-question"></i> Talvez
                        </button>
                        <button class="btn-presenca btn-recusar" onclick="salvarPresenca('Recusado')">
                            <i class="fas fa-times"></i> Recusar
                        </button>
                    </div>
                    <div id="feedback-presenca" class="feedback"></div>
                </section>
                
                <section class="participantes-section">
                    <h3><i class="fas fa-users"></i> Quem Vai?</h3>
                    <div id="participantes-status" class="status-container">
                        <!-- Status e listas de participantes injetados aqui -->
                    </div>
                </section>
                
                <button class="btn btn-primary" onclick="showPage('home')">Voltar para a Lista</button>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        © 2024 Rolê Certo. Todos os direitos reservados.
    </footer>

    <!-- Modal para Criar Evento -->
    <div id="create-event-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeCreateEventModal()">&times;</span>
            <h2>Criar Novo Evento</h2>
            <form id="create-event-form">
                <div class="form-group">
                    <label for="event-title">Título do Evento</label>
                    <input type="text" id="event-title" required>
                </div>
                <div class="form-group">
                    <label for="event-description">Descrição</label>
                    <textarea id="event-description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="event-date">Data</label>
                    <input type="date" id="event-date" required>
                </div>
                <div class="form-group">
                    <label for="event-time">Hora</label>
                    <input type="time" id="event-time" required>
                </div>
                <div class="form-group">
                    <label for="event-address">Endereço</label>
                    <input type="text" id="event-address" required>
                </div>
                <div class="form-group">
                    <label for="event-category">Categoria</label>
                    <select id="event-category" required>
                        <option value="">Selecione uma categoria</option>
                        <option value="Festa">Festa</option>
                        <option value="Cultural">Cultural</option>
                        <option value="Esportivo">Esportivo</option>
                        <option value="Online">Online</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <button type="submit" class="btn-form">Criar Evento</button>
                <p id="create-event-message" style="display: none;"></p>
            </form>
        </div>
    </div>
    
    <!-- Novo Modal para Login -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeLoginModal()">&times;</span>
            <h2>Entrar no Rolê Certo</h2>
            <p class="text-center text-gray-500 mb-6">Escolha uma opção de login para continuar.</p>
            <button id="google-sign-in-btn" onclick="handleGoogleSignIn()">
                <i class="fab fa-google"></i>
                Entrar com Google
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const eventosContainer = document.getElementById('eventos-container');
            const detalhesPage = document.getElementById('detalhes-evento');
            const createEventModal = document.getElementById('create-event-modal');
            const loginModal = document.getElementById('login-modal');
            const createEventForm = document.getElementById('create-event-form');
            const mapContainer = document.getElementById('map-container');
            const mapError = document.getElementById('map-error-message');
            const createEventMessage = document.getElementById('create-event-message');

            let mapa = null;
            let marker = null;
            let currentEventId = null;

            // Função para alternar as páginas
            window.showPage = function(pageId) {
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageId).classList.add('active');
            };

            // Função para mostrar o modal de criação de evento
            window.showCreateEventModal = function() {
                createEventModal.style.display = 'flex';
                createEventMessage.style.display = 'none'; // Reseta a mensagem
                createEventForm.reset();
            };

            // Função para fechar o modal de criação de evento
            window.closeCreateEventModal = function() {
                createEventModal.style.display = 'none';
                createEventForm.reset();
            };
            
            // Função para mostrar o modal de login
            window.showLoginModal = function() {
                loginModal.style.display = 'flex';
            };

            // Função para fechar o modal de login
            window.closeLoginModal = function() {
                loginModal.style.display = 'none';
            };


            // Nova função de formatação de data
            window.formatarDataCompleta = function(dataString) {
                // Se for um objeto Timestamp do Firebase
                if (typeof dataString === 'object' && dataString.toDate) {
                    const data = dataString.toDate();
                    const dia = String(data.getDate()).padStart(2, '0');
                    const mes = String(data.getMonth() + 1).padStart(2, '0');
                    const ano = data.getFullYear();
                    const diaSemana = data.toLocaleDateString('pt-BR', { weekday: 'long' });
                    return `${dia}/${mes}/${ano} (${diaSemana})`;
                }
                
                // Se for string no formato ISO (YYYY-MM-DD)
                if (typeof dataString === 'string' && dataString.includes('-')) {
                    const partes = dataString.split('T')[0].split('-');
                    const ano = partes[0];
                    const mes = partes[1];
                    const dia = partes[2];
                    const data = new Date(ano, mes - 1, dia);
                    const diaSemana = data.toLocaleDateString('pt-BR', { weekday: 'long' });
                    return `${dia}/${mes}/${ano} (${diaSemana})`;
                }
                
                // Se for string em outro formato
                try {
                    const data = new Date(dataString);
                    if (!isNaN(data)) {
                        const dia = String(data.getDate()).padStart(2, '0');
                        const mes = String(data.getMonth() + 1).padStart(2, '0');
                        const ano = data.getFullYear();
                        const diaSemana = data.toLocaleDateString('pt-BR', { weekday: 'long' });
                        return `${dia}/${mes}/${ano} (${diaSemana})`;
                    }
                } catch (e) {
                    console.error("Erro ao formatar data:", e);
                }
                
                return "Data inválida";
            }

            // Função para formatar a hora
            function formatarHora(dataString) {
                const data = new Date(dataString);
                const hora = String(data.getHours()).padStart(2, '0');
                const minutos = String(data.getMinutes()).padStart(2, '0');
                return `${hora}:${minutos}`;
            }

            // Função para renderizar os cards de eventos
            function renderizarEventos(eventos) {
                eventosContainer.innerHTML = '';
                eventos.forEach(evento => {
                    const data = new Date(evento.dataHora);
                    const dia = String(data.getDate()).padStart(2, '0');
                    const mes = data.toLocaleDateString('pt-BR', { month: 'short' }).toUpperCase();
                    
                    const eventCard = document.createElement('div');
                    eventCard.classList.add('event-card');
                    eventCard.innerHTML = `
                        <div class="card-header">
                            <h3 class="event-title">${evento.titulo}</h3>
                            <span class="event-badge">${evento.categoria}</span>
                        </div>
                        <div class="card-content">
                            <div class="date-container">
                                <div class="date-circle">
                                    <span class="day">${dia}</span>
                                    <span class="month">${mes}</span>
                                </div>
                                <div class="date-info">
                                    <p class="event-date">${formatarDataCompleta(evento.dataHora)}</p>
                                    <p class="event-time">${formatarHora(evento.dataHora)}</p>
                                </div>
                            </div>
                            <div class="event-info">
                                <i class="fas fa-map-marker-alt"></i>
                                <p class="event-detail">${evento.endereco}</p>
                            </div>
                            <div class="event-info">
                                <i class="fas fa-info-circle"></i>
                                <p class="event-detail">${evento.descricao.substring(0, 100)}...</p>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="card-btn" onclick="verDetalhes('${evento.id}')">
                                <i class="fas fa-eye"></i> Ver Detalhes
                            </button>
                            <button class="card-btn" onclick="verDetalhesDoMapa('${evento.id}')">
                                <i class="fas fa-map"></i> Mapa
                            </button>
                        </div>
                    `;
                    eventosContainer.appendChild(eventCard);
                });
            }
            
            // Função para buscar e renderizar eventos do Firestore
            async function carregarEventos() {
                if (!window.db || !window.onSnapshot || !window.collection) {
                    console.error("Serviços do Firebase não disponíveis.");
                    return;
                }
                const colRef = collection(db, "eventos");
                onSnapshot(colRef, (snapshot) => {
                    const eventos = [];
                    snapshot.docs.forEach((doc) => {
                        eventos.push({ ...doc.data(), id: doc.id });
                    });
                    renderizarEventos(eventos);
                });
            }

            // Função para exibir detalhes de um evento
            window.verDetalhes = async function(eventId) {
                currentEventId = eventId;
                if (!window.db || !window.doc || !window.getDoc) {
                    console.error("Serviços do Firebase não disponíveis.");
                    return;
                }
                const docRef = doc(db, "eventos", eventId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const evento = docSnap.data();
                    document.getElementById('detalhes-titulo').textContent = evento.titulo;
                    document.getElementById('detalhes-categoria').textContent = evento.categoria;
                    document.getElementById('detalhes-descricao').textContent = evento.descricao;
                    
                    const detalhesInfo = document.getElementById('detalhes-info');
                    detalhesInfo.innerHTML = `
                        <div class="info-item">
                            <div class="info-icon"><i class="fas fa-calendar-alt"></i></div>
                            <div class="info-text">
                                <h3>Data</h3>
                                <p>${formatarDataCompleta(evento.dataHora)}</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon"><i class="fas fa-clock"></i></div>
                            <div class="info-text">
                                <h3>Horário</h3>
                                <p>${formatarHora(evento.dataHora)}</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon"><i class="fas fa-map-marker-alt"></i></div>
                            <div class="info-text">
                                <h3>Local</h3>
                                <p>${evento.endereco}</p>
                            </div>
                        </div>
                    `;
                    
                    showPage('detalhes-evento');
                    verNoMapa(evento.endereco);
                    carregarParticipantes(eventId);

                } else {
                    console.error("Evento não encontrado!");
                }
            };
            
            // Nova função para ver os detalhes e o mapa
            window.verDetalhesDoMapa = async function(eventId) {
                await verDetalhes(eventId);
                document.getElementById('map-container').scrollIntoView({ behavior: 'smooth' });
            };
            
            // Função para carregar a lista de participantes
            async function carregarParticipantes(eventId) {
                if (!window.db || !window.onSnapshot || !window.collection) {
                    console.error("Serviços do Firebase não disponíveis.");
                    return;
                }
                const colRef = collection(db, `eventos/${eventId}/presencas`);
                onSnapshot(colRef, (snapshot) => {
                    const confirmados = [];
                    const talvez = [];
                    const recusados = [];

                    snapshot.docs.forEach((doc) => {
                        const participante = doc.data();
                        if (participante.status === 'Confirmado') {
                            confirmados.push(participante.nome);
                        } else if (participante.status === 'Talvez') {
                            talvez.push(participante.nome);
                        } else if (participante.status === 'Recusado') {
                            recusados.push(participante.nome);
                        }
                    });

                    renderizarParticipantes({ confirmados, talvez, recusados });
                });
            }
            
            // Função para renderizar as listas de participantes
            function renderizarParticipantes(participantes) {
                const statusContainer = document.getElementById('participantes-status');
                statusContainer.innerHTML = '';
                
                const criarStatusBox = (titulo, icon, lista, cor, classe) => {
                    const box = document.createElement('div');
                    box.classList.add('status-box', classe);
                    box.innerHTML = `
                        <div class="status-header">
                            <h4><i class="fas ${icon}"></i> ${titulo}</h4>
                            <span>${lista.length}</span>
                        </div>
                        <ul class="participantes-lista">
                            ${lista.map(nome => `<li>${nome}</li>`).join('')}
                        </ul>
                    `;
                    return box;
                };

                statusContainer.appendChild(criarStatusBox('Confirmados', 'fa-check-circle', participantes.confirmados, 'verde', 'confirmados'));
                statusContainer.appendChild(criarStatusBox('Talvez', 'fa-question-circle', participantes.talvez, 'laranja', 'pendentes'));
                statusContainer.appendChild(criarStatusBox('Recusados', 'fa-times-circle', participantes.recusados, 'roxo', 'recusados'));
            }

            // Função para salvar a presença do participante
            window.salvarPresenca = async function(status) {
                if (!window.userId || !window.db || !window.doc || !window.setDoc) {
                    console.error("Usuário não autenticado ou serviços do Firebase não disponíveis.");
                    const feedbackDiv = document.getElementById('feedback-presenca');
                    feedbackDiv.className = `feedback ativo feedback-recusado`;
                    feedbackDiv.textContent = 'Você precisa estar logado para confirmar presença.';
                    return;
                }
                
                const nomeInput = document.getElementById('nome-participante');
                const nome = nomeInput.value.trim() || window.userName || 'Anônimo';

                if (!nome || nome === 'Anônimo' && !window.userName) {
                    const feedbackDiv = document.getElementById('feedback-presenca');
                    feedbackDiv.className = `feedback ativo feedback-recusado`;
                    feedbackDiv.textContent = 'Por favor, digite seu nome.';
                    return;
                }
                
                const feedbackDiv = document.getElementById('feedback-presenca');
                
                try {
                    const presencaRef = doc(db, `eventos/${currentEventId}/presencas`, window.userId);
                    await setDoc(presencaRef, {
                        nome,
                        status,
                        timestamp: new Date()
                    });

                    let feedbackMessage = '';
                    let feedbackClass = '';

                    if (status === 'Confirmado') {
                        feedbackMessage = `🎉 Confirmação de presença de ${nome} registrada com sucesso!`;
                        feedbackClass = 'feedback-confirmado';
                    } else if (status === 'Talvez') {
                        feedbackMessage = `🤔 Presença de ${nome} marcada como "Talvez".`;
                        feedbackClass = 'feedback-talvez';
                    } else {
                        feedbackMessage = `😔 Presença de ${nome} recusada.`;
                        feedbackClass = 'feedback-recusado';
                    }

                    feedbackDiv.className = `feedback ativo ${feedbackClass}`;
                    feedbackDiv.textContent = feedbackMessage;

                } catch (e) {
                    console.error("Erro ao salvar a presença:", e);
                    feedbackDiv.className = `feedback ativo feedback-recusado`;
                    feedbackDiv.textContent = 'Erro ao salvar sua presença.';
                }
            };
            
            // Submissão do formulário de criação de evento
            createEventForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!window.db || !window.addDoc || !window.collection) {
                    console.error("Serviços do Firebase não disponíveis.");
                    return;
                }
                
                const titulo = document.getElementById('event-title').value;
                const descricao = document.getElementById('event-description').value;
                const data = document.getElementById('event-date').value;
                const hora = document.getElementById('event-time').value;
                const endereco = document.getElementById('event-address').value;
                const categoria = document.getElementById('event-category').value;
                
                const dataHora = new Date(`${data}T${hora}`);

                try {
                    await addDoc(collection(db, "eventos"), {
                        titulo,
                        descricao,
                        dataHora: dataHora,
                        endereco,
                        categoria,
                        criadoEm: new Date(),
                        criadoPor: window.userName || 'Anônimo'
                    });
                    
                    createEventMessage.textContent = '🎉 Evento criado com sucesso!';
                    createEventMessage.style.display = 'block';
                    createEventForm.reset();
                    
                } catch (e) {
                    console.error("Erro ao adicionar documento: ", e);
                    createEventMessage.textContent = 'Erro ao criar o evento.';
                    createEventMessage.style.color = 'var(--roxo)';
                    createEventMessage.style.display = 'block';
                }
            });

            // Função para inicializar o mapa
            window.verNoMapa = function(address) {
                if (!address) {
                    mapContainer.style.display = 'block';
                    mapError.style.display = 'block';
                    if (mapa) {
                        mapa.remove();
                        mapa = null;
                        marker = null;
                    }
                    return;
                }
                
                const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
                
                fetch(geocodeUrl)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.length > 0) {
                            const lat = data[0].lat;
                            const lon = data[0].lon;

                            if (mapa) {
                                mapa.setView([lat, lon], 13);
                                if (marker) {
                                    mapa.removeLayer(marker);
                                }
                            } else {
                                mapa = L.map('map').setView([lat, lon], 13);
                                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                                }).addTo(mapa);
                            }
                            
                            marker = L.marker([lat, lon]).addTo(mapa)
                                .bindPopup(address)
                                .openPopup();
                            
                            mapContainer.style.display = 'block';
                            mapError.style.display = 'none';

                        } else {
                            mapContainer.style.display = 'block';
                            mapError.style.display = 'block';
                            if (mapa) {
                                mapa.remove();
                                mapa = null;
                                marker = null;
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao geocodificar o endereço:', error);
                        mapContainer.style.display = 'block';
                        mapError.style.display = 'block';
                        if (mapa) {
                            mapa.remove();
                            mapa = null;
                            marker = null;
                        }
                    });
            };
            
            carregarEventos();
        });
    </script>
</body>
</html>
